<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>


    $(document).ready(function () {
        $('#btnReply').click(function (e) {
            e.preventDefault();
            var comment = {};
            comment["userId"] = $("#userId").val();
            comment["recipeNo"] = $("#recipeNo").val();
            comment["reply"] = $('#reply').val();
            InsertReply(comment);
        });
    });

    function InsertReply(comment) {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/comment/insert",
            data: JSON.stringify(comment),
            dataType: 'json',
            complete: function (){
                commentLoad();
                $('#reply').val('');
            }
        })
    };

    function commentLoad() {
        var recipeNo = $("#recipeNo").val();
        $.ajax({
            url: '/commentList',
            type: 'POST',
            data: {'recipeNo': recipeNo},
            dataType: 'json',
            success: function (result) {
                var cmt = '';
                $.each(result, function (key, value) {
                    cmt += '<div class="commentArea" style="border-bottom:1px solid darkgray; margin-bottom: 15px;">';
                    cmt += '<div class="commentInfo">' + '댓글번호 : ' + value.commentNo + ' / 작성자 : ' + value.userId;
                    cmt += '<a onclick="commentUpdate('+value.commentNo+');"> 수정 </a>';
                    cmt += '<a onclick="commentDelete('+value.commentNo+');"> 삭제 </a> </div>';
                    cmt += '<div class="commentContent'+value.commentNo+'"> <p> 내용 : ' + value.reply + '</p></div>';
                    cmt += '<div class="commentModify commentModify'+value.commentNo+'"></div>';

                    cmt += '</div>';
                });
                $(".commentList").html(cmt);
            }
        });
    }

    function commentDelete(commentNo){
        $.ajax({
            type : 'DELETE',
            url : '/comment/delete/' + commentNo,
            success : function(result){
                console.log("삭제")
                if(result == 1)
                    commentLoad(recipeNo); //댓글 삭제후 목록 출력
            }
        });
    }


    function getComment(commentNo) {
        return $.ajax({
            type: "GET",
            url: "/comment/" +commentNo,
            contentType: 'application/json',
        });
    }

    function commentUpdate(commentNo) {
        getComment(commentNo).then(function (result) {
            $('.commentModify').html("");
            var a = '';
            a += '<div class="input-group">';
            a += '<input type="text" class="form-cont' +
                'rol" name="reply_' + commentNo + '" value="' + result.reply + '"/>';
            a += '<span class="input-group-btn"><button class="btn btn-default" type="button" onclick="update(' + commentNo + ',\'' + result.reply + '\');">수정</button> </span>';
            a += '</div>';
            $('.commentModify' + result.commentNo).html(a);
            console.log(reply);
        });
    }
    function update(commentNo,reply) {
        var comment = {};
        comment["commentNo"] = commentNo;
        comment["reply"]= $('[name=reply_'+commentNo+']').val();
        console.log(comment);
        $.ajax({
            type: 'PUT',
            data: JSON.stringify(comment),
            dataType: 'json',
            async: true,
            url: '/comment/update/' + commentNo,
            contentType: 'application/js' + 'on; charset=utf-8',
            complete: function (){
                console.log("업데이트");
                commentLoad(); //댓글 삭제후 목록 출력
            }
        });
    };

    $(document).ready(function () {
        commentLoad();
    });


</script>