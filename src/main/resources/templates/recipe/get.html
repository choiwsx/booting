<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Title</title>
</head>
<body>
여기는 레시피 리스트 이란다.
<table>
    <tr>
        <td th:text="${recipe.title}"></td><br>
        <td th:text="${recipe.thumbnail}"></td><br>
        <td th:text="${recipe.content}"></td>
    <tr th:each="ranTag : ${recipeTag}">
        <td th:text=" ${'#' + ranTag}"></td>
    </tr>

<!--    <tr th:each="comm : ${comment}">-->
<!--        <td th:text="${comm.commentNo}"></td>-->
<!--        <td th:text="${'댓글: '+comm.reply}"></td>-->
<!--        <td th:text="${'작성자: '+comm.userId}"></td>-->
<!--    </tr>-->
</table>
<input type="hidden" id="userId" th:value="user01">
<!--    <input type="hidden" id="userId" th:value="${session.userId}">-->
<input type="hidden" id="recipeNo" th:value="${recipe.recipeNo}">
<div class="commentList">
</div>
<th:block th:insert="recipe/comment"></th:block>
 <input type="text" id="reply" placeholder="Comment">
<input type="button" id="btnReply" value="작성">


<hr>
<br>
<div id="scrapDiv">
    <!-- 여기서 getMapping으로 보낸 데이터 확인해서 이미 내가찜했으면 찜취소로 보여줘야함 -->
    <input th:if="${scrap == null}"
           type="button" th:id="create-scrap" value="찜 하기">
    <input th:unless="${scrap == null}"
           type="button" th:id="delete-scrap" value="찜 취소">
</div>
<div>
    <p>좋아요</p>
</div>



<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript">

        $(document).ready(function () {
            let scrapDiv = $("#scrapDiv");

            $(document).on("click", "#create-scrap", (function (event) {
                btn_ajaxsubmit(true);
            }));

            $(document).on("click", "#delete-scrap", (function (event) {
                btn_ajaxsubmit(false);
            }));

        });

        function get_scrap() {
            return $.ajax({
                type: "GET",
                url: "/recipe/goScrap/" + $("#userId").val() + "/" + $("#recipeNo").val(),
                contentType: 'application/json'
            });
        }

        function btn_ajaxsubmit(flag) {
            var scrap = {};
            scrap["userId"] = $("#userId").val();
            scrap["recipeNo"] = $("#recipeNo").val();

            if (flag) {
                // 찜하기를 누르면
                console.log("저장 : ", flag);
                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: "/recipe/saveScrapAjax",
                    data: JSON.stringify(scrap),
                    dataType: 'json',
                    success:
                        get_scrap().then(function (response) {
                            console.log("RESPONSE찜하기 : ", response);
                            scrapDiv.innerHTML = "";
                            scrapDiv.innerHTML = "<input type='button' id='delete-scrap' value='찜 취소'>";
                        })
                });
            } else {
                // 찜 취소를 누르면
                console.log("삭제 : ", flag);
                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: "/recipe/deleteScrapAjax",
                    data: JSON.stringify(scrap),
                    dataType: 'json',
                    success:
                    // function (data) {
                    // console.log("SUCESS: ", data);
                        get_scrap().then(function (response) {
                            console.log("RESPONSE찜취소 : ", response);
                            scrapDiv.innerHTML = "";
                            scrapDiv.innerHTML = "<input type='button' id='create-scrap' value='찜 하기'>";
                        })
                    // }
                });
            }
        }
</script>
</body>
</html>