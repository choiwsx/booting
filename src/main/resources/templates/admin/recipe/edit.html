<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <meta http-equiv="Content-Type">
    <title>Title</title>
</head>
<body>
레시피 수정

<form id="recipe-form">
    <input type="text" id="userId" th:value="${recipe.getProfile().getUserId()}">
    <input type="text" id="recipeNo" th:value="${recipe.getRecipeNo()}">

    제목<input type="text" id="title" th:value="${recipe.title}">
    내용<input type="text" id="content" th:value="${recipe.content}">
    카테고리 코드(100)<input type="text" id="categoryNo" th:value="${recipe.getCategory().getCategoryNo()}">
    재료 <tr th:each="ingredients, stat: *{recipe.ingredients}">
    <td><input type="text" th:value="${ingredients.getName()}" class="IngreN"/></td>
    <td><input type="text" th:value="${ingredients.getAmount()}" class="IngreA"/></td>
</tr>
    스텝
    <tr th:each="step, stat: *{recipe.steps}">
        <td><input type="text" th:value="${step.getContent()}" class="stepC"/></td>
        <td><input type="text" th:value="${step.getThumbnail()}" class="stepT"/></td>
    </tr>
    <div>
        <button type="submit" value="Submit">등록 테스트</button>
    </div>
</form>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){

    });

    $("#recipe-form").submit(function(event){
        event.preventDefault();
        btn_ajaxsubmit();

    });

    function btn_ajaxsubmit(){
        var test ={};
        var profile = {};
        var category = {};
        category["categoryNo"] = $("#categoryNo").val();
        profile["userId"] = $("#userId").val();
        test["title"] = $("#title").val();
        test["profile"] = profile;
        test["content"] = $("#content").val();
        test["category"] = category;



        var stepT = $(".stepT");
        var stepC = $(".stepC");
        var inStep  =[];
        var stepLength = stepT.length;
        for(let i=0; i<stepLength; i++)
        {
            var steps = {};
            steps["stepNo"] = i+1;
            steps["thumbnail"] = stepT.get(i).value;
            steps["content"] = stepC.get(i).value;
            inStep.push(steps);
        }

        var IngreN = $(".ingre_name");
        var IngreA = $(".ingre_amount");
        var inIngre = [];
        var IngreLength = IngreN.length;
        for(let i=0; i<IngreLength; i++)
        {
            var steps = {};
            steps["ingredientNo"] = i+1;
            steps["name"] = IngreN[i].value;
            steps["amount"] = IngreA[i].value;
            inIngre.push(steps);
        }

        test["steps"]=inStep;
        test["ingredients"]=inIngre;

        $.ajax({
            type:"POST",
            contentType : "application/json;charset=utf-8",
            url : '/recipe/ajaxTest',
            data : JSON.stringify(test),
            dataType : "json",
            success:function(data){
                console.log("SUCESS: ", data );
            }
        })
    }
</script>
</body>
</html>