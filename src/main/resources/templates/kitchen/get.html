<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>주방</title>
</head>
<style>
    .thumbnail {
        width: 100px; height: 100px;
        object-fit: cover;
        object-position: top;
        border-radius: 50%;
    }
</style>
<body>
<h1>다른 애 주방</h1>
<div sec:authorize="isAuthenticated()">
    인증된 사용자만 보입니당.
    <input type="hidden" id="userId" th:value= "${#authentication.principal.userId}">
</div>
<input type="hidden" id="followUserId" th:value="${profile.userId}">
    <img class="thumbnail" th:src="${profile.getThumbnail()}">
<div th:type="text" th:if="${private == false}">
    <input type="hidden" name="status" value="false">
    공개 계정, 게시물 ㅇㅇ
<!--    <table>-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th>순서</th>-->
<!--            <th>제목</th>-->
<!--            <th>썸넬</th>-->
<!--            <th>소개</th>-->
<!--            <th>삭제하기</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tr th:each="recipe, stat: *{recipes}">-->
<!--            <td th:text="${stat.count}" ></td>-->
<!--            <td><a th:href="@{'/recipe/'+${recipe.recipeNo}}"><p th:text="${recipe.title}"></a></td>-->
<!--            <td><img th:src="@{'/display?fileName='+${recipe.getThumbnail()}}" style="width: 250px; height: 250px;"></td>-->
<!--            <td th:text="${recipe.content}"></td>-->
<!--            <td><a th:href="@{'/recipe/delete/' + ${recipe.recipeNo}}">삭제</a></td>-->
<!--        </tr>-->
<!--    </table>-->
</div>
<div th:type="text" th:unless="${private == false}">
    <input type="hidden" name="status" value="true">
    비공개 계정, 게시물 ㄴㄴ
</div>
<!-- 프로필 -->
<p th:text="'닉네임 : '+${profile.nickname}"></p>
<p th:text="'자기소개 : '+${profile.bio}"></p>
<a href="#">
<p th:text="'팔로잉(내가 팔로잉하는 사람들) : '+${followings.size()}"></p>
</a>
<a href="#">
    <p th:text="'팔로워(나를 팔로워하는 사람들) : '+${followers.size()}"></p>
</a>
<!-- 팔로우 -->
<div id="followDiv">
<!--  내가 팔로우 안한 계정이면 팔로우하기 보이기  -->
    <input th:if="${isFollow == null}" th:id="create-follow" type="button" value="팔로우">
    <input th:unless="${isFollow == null}" th:id="delete-follow" type="button" value="팔로우취소">
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript">
    // var followDiv = $('#followDiv');

    $(document).ready(function() {
        $(document).on("click", "#create-follow", (function (event) {
            btn_followsubmit(true);
        }));

        $(document).on("click", "#delete-follow", (function (event) {
            btn_followsubmit(false);
        }));
    });

    function btn_followsubmit(flag) {
        var follow = {};
        follow["userId"] = $("#userId").val();
        follow["followUserId"] = $("#followUserId").val();
        follow["status"] = $('input[name=status]').val();

        // 로그인 안한 사용자가 팔로우 누르면 return
        if($("#userId").val() == null)
        {
            alert('로그인이 필요합니다');
            return;
        }

        if(flag)
        {
            // 팔로우를 누르면
            console.log("팔로우 저장 : ",flag);
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/kitchen/saveFollowAjax",
                data: JSON.stringify(follow),
                dataType: 'json',
                success:
                    get_follow().then(function(response) {
                        console.log("RESPONSE 팔로우 : ", response);
                        followDiv.innerHTML = "";
                        followDiv.innerHTML = "<input type='button' id='delete-follow' value='팔로우 취소'>";
                    })
            });
        }
        else
        {
            // 팔로우 취소를 누르면
            console.log("팔로우 삭제 : ",flag);
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/kitchen/deleteFollowAjax",
                data: JSON.stringify(follow),
                dataType: 'json',
                success:
                    get_follow().then(function(response) {
                        console.log("RESPONSE 팔로우 취소 : ", response);
                        followDiv.innerHTML = "";
                        followDiv.innerHTML = "<input type='button' id='create-follow' value='팔로우'>";
                    })
            });
        }
    }
    function get_follow() {
        return $.ajax({
            type : "GET",
            url: "/kitchen/goFollow/"+$("#userId").val()+"/"+$("#followUserId").val(),
            contentType : 'application/json'
        });
    }
</script>
</body>
</html>