<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Title</title>
</head>
<body>
내가 비공개 계정이면 팔로우 신청한 계정들 목록
<table>
    <thead>
    <tr>
        <th>번호</th>
        <th>신청자 아이디</th>
        <th>수락</th>
        <th>거절</th>
    </tr>
    </thead>

    <tr th:each="follower, stat: *{user.followers}">
        <div class="applyDiv" th:id="'applyDiv'+${stat.count}">
            <input type="hidden" id="followUserId" th:value="${#authentication.principal.userId}">
            <input type="hidden" id="userId" th:value="${follower.userId}">
            <td th:text="${stat.count}"></td>
            <td><a th:href="@{'/kitchen/'+${follower.userId}}"><p th:text="${follower.userId}"></a></td>
            <div id="followDiv">
                <td><input th:id="update-follow" type="button" value="수락"></td>
                <td><input th:id="delete-follow" type="button" value="거절"></td>
            </div>
        </div>
    </tr>

</table>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript">

    $(document).ready(function () {
        $(document).on("click", "#update-follow", (function (event) {
            btn_followsubmit(true);
        }));

        $(document).on("click", "#delete-follow", (function (event) {
            btn_followsubmit(false);
        }));
    });

    function btn_followsubmit(flag) {
        // var applyNum = $("")
        var followId = {};
        followId["user"] = $("#userId").val();
        followId["followUser"] = $("#followUserId").val();


        if (flag) {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/kitchen/updateFollowAjax",
                data: JSON.stringify(followId),
                dataType: 'text',
                success:
                    get_follow().then(function (response) {
                        console.log("RESPONSE 수락 : ", response);
                        var tmp = '';
                        for(i=1; i<response.size(); i++)
                        {
                            tmp += '<input type="hidden" id="followUserId" value='+ response[i].followUserId +'>';
                            tmp += '<input type="hidden" id="userId" value='+ response[i].userId +'>';
                            tmp += '<td><a href=""';
                        }
                        $(".applyDiv").html(tmp);
                    })
            });
        } else {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/kitchen/deleteFollowAjax",
                data: JSON.stringify(followId),
                dataType: 'text',
                success:
                    get_follow().then(function (response) {
                        console.log("RESPONSE 거절 : ", response);
                        // followDiv.innerHTML = "";
                    })
            });
        }
    }

    function get_follow() {
        return $.ajax({
            type: "GET",
            url: "/kitchen/goFollow/" + $("#userId").val() + "/" + $("#followUserId").val(),
            contentType: 'application/json'
        });
    }
</script>
</body>
</html>